!function(t){function e(t){return Math.floor(Math.random()*t)}function n(t,n){var n,s,a,i=[],o=t.split("");for(n>o.length&&(n=o.length),l=o.length,s=0;s<n;s++)a=e(l--),i.push(o[a]),o.splice(a,1);return i.join("")}function s(t){var n,s,a=t.split(""),i=2*a.length,o=i,r=[];for(a=a.concat(a),s=0;s<i;s++)n=e(o--),r.push(a[n]),a.splice(n,1);return r}function a(e,n,s){var a=t(".msg");a.find(".txt p").html(e),a.show(),setTimeout(function(){a.hide(),s&&s()},n)}function i(e,n){var s=t(".msg"),a=s.find(".ask");s.find(".txt p").html(e),a.show(),s.find(".assure").unbind().on("click",function(){var e=t("#nickname").val();n&&n(e),a.hide(),s.hide()}),s.show()}var o=8,r={row:4,pair:0,num:16,oneShow:!1,step:0,tcount:null,initParam:function(e){e&&(this.row=e),this.row%2?this.num=this.row*(this.row+1):this.num=this.row*this.row,this.pair=0,this.step=0,t("#steps").text(this.step),t("#time_min").text("00"),t("#time_sec").text("00"),oneShow=!1},start:function(e){this.initParam(e);var l='<div class="item un" {style} data-no="{index}"><div class="back"><span></span></div><div class="front"></div></div>',u="",h="ABCDEFGHI☆J❤KLMNOPQRSTUVWXYZ12345678♂♀♠♣★△▽囧你我她",m=[],d=t("#map").width(),f=0;f=(d-4*e)/e;for(var v=0;v<r.num;v++)u+=l.replace(/{index}/g,v);u=u.replace(/{style}/g,'style="width:'+f+"px;height:"+f+'px;"'),t("#map").html(u),m=s(n(h,r.num/2)),t("#map").unbind().on("tap",".item",function(){var e=t(this),n=t(".show"),s=0,l=null,u={};if(!e.hasClass("match")&&!e.hasClass("show"))if(e.hasClass("un")&&e.removeClass("un"),e.addClass("show").find("span").text(m[e.data("no")]),r.oneShow){if(r.step++,t("#steps").text(r.step),r.oneShow=!1,n.find("span").text()==m[e.data("no")]){if(r.pair++,r.pair==r.num/2){if(t("#level_pass").append("<li>Level "+(r.row-1)+": 用了<span>"+r.step+"</span>步| 耗时：<span>"+t("#time_min").text()+"</span>分<span>"+t("#time_sec").text()+"</span>秒</li>"),r.tcount&&clearInterval(r.tcount),r.row==o)return s=r.summary(),void(p.isBreakRange(s)?i("通关，敢问阁下高姓大名？",function(t){t&&(u.step=s,u.id=t,l=r.countTime(),u.min=l.min,u.sec=l.sec,c.upload(u,"POST")),setTimeout(function(){location=location},1500)}):a("Game Over,加油哦~",1e3,function(){setTimeout(function(){location=location},1500)}));a("过关~继续闯关吧~~",1e3,function(){r.start(++r.row)})}setTimeout(function(){n.addClass("match").removeClass("show"),e.addClass("match").removeClass("show")},500)}}else 0==r.step&&(r.tcount&&clearInterval(r.tcount),r.tcount=setInterval(function(){var e=1*t("#time_sec").text(),n=0;if(e++,e<10)return void t("#time_sec").text("0"+e);if(e>60){if(t("#time_sec").text("00"),n=1*t("#time_min").text(),n++,n<9)return void t("#time_min").text("0"+n);t("#time_min").text(n)}else t("#time_sec").text(e)},1e3)),n.removeClass("show").find("span").text(""),r.oneShow=!0})},summary:function(){var e=0;return t("#level_pass li").each(function(){e+=1*t(this).find("span").eq(0).text()}),e},countTime:function(){var e=0,n=0,s={};return t("#level_pass li").each(function(){e+=1*t(this).find("span").eq(1).text(),n+=1*t(this).find("span").eq(2).text()}),e+=Math.floor(n/60),n%=60,s.sec=n,s.min=e,s}},c={datas:{short_name:"shellphon",thread_key:"g-match",secret:"980060bdb2bb38f1bdf5d73b37382696",author_name:"g-match-mobile",message:""},url:"http://api.duoshuo.com/posts/create.json",upload:function(t,e){var n=this.datas;n.message=JSON.stringify(t),this.postIframe(this.url,e,n)},postIframe:function(t,e,n){var s=document.createElement("iframe");document.body.appendChild(s),s.style.display="none";var a="frame_name"+(new Date).getTime();s.contentWindow.name=a;var i=document.createElement("form");i.target=a,i.action=t,i.method=e;for(var o in n)if(n.hasOwnProperty(o)){var r=document.createElement("input");r.type="hidden",r.name=o,r.value=n[o],i.appendChild(r)}document.body.appendChild(i),i.submit()}},p={range:[],pull:function(){var e=this;t.ajax({type:"get",async:!1,cache:!0,url:"http://api.duoshuo.com/threads/listPosts.jsonp?order=desc&thread_key=g-match&short_name=shellphon&page=1&limit=15",dataType:"jsonp",jsonp:"callback",success:function(t){var n,s,a,i=[];if(t.parentPosts)for(n in t.parentPosts)s=t.parentPosts[n].message.replace(/\&quot;/g,'"'),a=JSON.parse(s),a.time=t.parentPosts[n].created_at,i.push(a);e.range=e.sortRange(i),e.showRange()}})},sortRange:function(t){return t.sort(function(t,e){return t.step-e.step})},showRange:function(){for(var e,n="<tr><td>{i}</td><td>{id}</td><td>{step}</td><td>{time}</td></tr>",s="",a=0;a<this.range.length;a++)e=this.range[a],s+=n.replace(/{i}/g,a+1).replace(/{id}/g,e.id).replace(/{step}/g,e.step).replace(/{time}/g,e.min+":"+e.sec);t("#range").html(s)},isBreakRange:function(t){return this.range.length<10||this.range.slice(0,10).some(function(e){return e.step>t})}};p.pull(),r.start(2)}(Zepto);