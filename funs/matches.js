!function(t){function e(t){return Math.floor(Math.random()*t)}function n(t,n){var n,s,a,i=[],o=t.split("");for(n>o.length&&(n=o.length),l=o.length,s=0;s<n;s++)a=e(l--),i.push(o[a]),o.splice(a,1);return i.join("")}function s(t){var n,s,a=t.split(""),i=2*a.length,o=i,r=[];for(a=a.concat(a),s=0;s<i;s++)n=e(o--),r.push(a[n]),a.splice(n,1);return r}var a=8,i={row:4,pair:0,num:16,oneShow:!1,step:0,tcount:null,initParam:function(e){e&&(this.row=e),this.row%2?this.num=this.row*(this.row+1):this.num=this.row*this.row,this.pair=0,this.step=0,t("#steps").text(this.step),t("#time_min").text("00"),t("#time_sec").text("00"),oneShow=!1,t("#map").css("width",100*this.row+"px"),this.row>6&&t("#map").css({transform:"scale(0.8)"})},start:function(e){this.initParam(e);for(var c='<div class="item un" data-no="{index}"><div class="back"><span></span></div><div class="front"></div></div>',m="",p="ABCDEFGHI☆J❤KLMNOPQRSTUVWXYZ12345678♂♀♠♣★△▽囧你我她",l=[],u=0;u<i.num;u++)m+=c.replace(/{index}/g,u);t("#map").html(m),l=s(n(p,i.num/2)),t("#map").unbind().on("click",".item",function(){var e=t(this),n=t(".show"),s=0,c=null,m={};if(!e.hasClass("match")&&!e.hasClass("show"))if(e.hasClass("un")&&e.removeClass("un"),e.addClass("show").find("span").text(l[e.data("no")]),i.oneShow){if(i.step++,t("#steps").text(i.step),i.oneShow=!1,n.find("span").text()==l[e.data("no")]){if(i.pair++,i.pair==i.num/2){if(t("#level_pass").append("<li>Level "+(i.row-1)+": 用了<span>"+i.step+"</span>步| 耗时：<span>"+t("#time_min").text()+"</span>分<span>"+t("#time_sec").text()+"</span>秒</li>"),i.tcount&&clearInterval(i.tcount),i.row==a)return s=i.summary(),void(r.isBreakRange(s)?bootbox.prompt("通关，敢问阁下高姓大名？",function(t){t&&(m.step=s,m.id=t,c=i.countTime(),m.min=c.min,m.sec=c.sec,o.upload(m,"POST")),bootbox.alert("Game Over。好腻害啊",function(){setTimeout(function(){location=location},1500)})}):bootbox.alert("Game Over,加油哦~",function(){setTimeout(function(){location=location},1500)}));bootbox.alert("过关~继续闯关吧~~",function(){i.start(++i.row)})}setTimeout(function(){n.addClass("match").removeClass("show"),e.addClass("match").removeClass("show")},500)}}else 0==i.step&&(i.tcount&&clearInterval(i.tcount),i.tcount=setInterval(function(){var e=1*t("#time_sec").text(),n=0;if(e++,e<10)return void t("#time_sec").text("0"+e);if(e>60){if(t("#time_sec").text("00"),n=1*t("#time_min").text(),n++,n<9)return void t("#time_min").text("0"+n);t("#time_min").text(n)}else t("#time_sec").text(e)},1e3)),n.removeClass("show").find("span").text(""),i.oneShow=!0})},summary:function(){var e=0;return t("#level_pass li").each(function(){e+=1*t(this).find("span").eq(0).text()}),e},countTime:function(){var e=0,n=0,s={};return t("#level_pass li").each(function(){e+=1*t(this).find("span").eq(1).text(),n+=1*t(this).find("span").eq(2).text()}),e+=Math.floor(n/60),n%=60,s.sec=n,s.min=e,s}},o={datas:{short_name:"shellphon",thread_key:"g-match",secret:"980060bdb2bb38f1bdf5d73b37382696",author_name:"g-match",message:""},url:"http://api.duoshuo.com/posts/create.json",upload:function(t,e){var n=this.datas;n.message=JSON.stringify(t),this.postIframe(this.url,e,n)},postIframe:function(t,e,n){var s=document.createElement("iframe");document.body.appendChild(s),s.style.display="none";var a="frame_name"+(new Date).getTime();s.contentWindow.name=a;var i=document.createElement("form");i.target=a,i.action=t,i.method=e;for(var o in n)if(n.hasOwnProperty(o)){var r=document.createElement("input");r.type="hidden",r.name=o,r.value=n[o],i.appendChild(r)}document.body.appendChild(i),i.submit()}},r={range:[],pull:function(){var e=this;t.ajax({type:"get",async:!1,cache:!0,url:"http://api.duoshuo.com/threads/listPosts.jsonp?order=desc&thread_key=g-match&short_name=shellphon&page=1&limit=15",dataType:"jsonp",jsonp:"callback",success:function(t){var n,s,a,i=[];if(t.parentPosts)for(n in t.parentPosts)s=t.parentPosts[n].message.replace(/\&quot;/g,'"'),a=JSON.parse(s),a.time=t.parentPosts[n].created_at,i.push(a);e.range=e.sortRange(i),e.showRange()}})},sortRange:function(t){return t.sort(function(t,e){return t.step-e.step})},showRange:function(){for(var e,n="<tr><td>{i}</td><td>{id}</td><td>{step}</td><td>{time}</td></tr>",s="",a=0;a<this.range.length;a++)e=this.range[a],s+=n.replace(/{i}/g,a+1).replace(/{id}/g,e.id).replace(/{step}/g,e.step).replace(/{time}/g,e.min+":"+e.sec);t("#range").html(s)},isBreakRange:function(t){return this.range.length<10||this.range.slice(0,10).some(function(e){return e.step>t})}};i.start(2)}(jQuery);